sudo: false

language: ruby

cache: bundler

rvm:
  - 2.0.0
  - 2.1
  - 2.2.6
  - 2.3.3

gemfile:
  - gemfiles/rails_4.2.gemfile
  - gemfiles/rails_5.0.gemfile

install:
  # This is to avoid a frozen string issue in RubyGems with Ruby 2.3.3.
  # @see https://github.com/rubygems/rubygems/pull/1819
  - gem update --system --no-doc
  - gem install bundler
  - bundle install

script:
  - bundle exec rake --trace test
  - bundle exec rubocop gemfiles/*.gemfile lib/ test/ Appraisals Gemfile Rakefile

matrix:
  fast_finish: true
  allow_failures:
    - gemfile: gemfiles/rails_5.0.gemfile
      rvm: 2.0.0
    - gemfile: gemfiles/rails_5.0.gemfile
      rvm: 2.1
